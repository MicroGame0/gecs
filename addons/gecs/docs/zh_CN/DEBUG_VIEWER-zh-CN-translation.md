# 调试查看器

> **为您的 ECS 项目提供实时调试和可视化**

GECS 调试查看器在游戏运行时提供实时的实体、组件、系统和关系的检查。非常适合理解实体行为、优化系统性能和调试复杂的交互。

## 📋 前置条件

*   您的项目中已启用 GECS 插件
*   调试模式已启用： `Project > Project Settings > GECS > Debug Mode`
*   从编辑器运行游戏（F5 或 F6）

## 🎯 快速启动

### 打开调试查看器

1.  **从 Godot 编辑器运行你的游戏** （当前场景按 F5，主场景按 F6）
2.  **打开调试面板** （编辑器底部，通常自动显示）
3.  **点击"GECS"标签** ，位于"Debugger"、"Errors"和"Profiler"旁边

> 💡 **需要调试模式** ：如果你看到覆盖层显示"Debug mode is disabled"，请前往 `Project > Project Settings > GECS` 并启用"Debug Mode"

## 🔍 功能概览

调试查看器分为两个主要面板：

### 系统面板（右）

实时监控系统执行和性能。

**特性：**

*   **系统执行时间** \- 查看每个系统处理所需时间（毫秒）
*   **实体数量** \- 每个系统处理的实体数量
*   **激活/非激活状态** \- 在运行时开启或关闭系统
*   **可排序列** \- 点击列标题按名称、时间或状态排序
*   **性能指标** \- 架构计数、并行处理信息

**状态栏：**

*   系统总数
*   组合执行时间
*   高成本系统突出显示

### 实体面板（左）

检查单个实体及其组件。

**功能：**

*   **实体层级** \- 查看您世界中的所有实体
*   **组件数据** \- 实时查看组件属性（开发中）
*   **关系** \- 可视化实体连接和关联
*   **搜索/筛选** \- 按名称查找实体或组件

## 🎮 使用调试查看器

### 监控系统性能

**按执行时间排序：**

1.  点击系统面板中的 **"时间 (ms)"** 列标题
2.  系统现在按性能排序（默认按最慢排序）
3.  再次点击以反转排序顺序

**识别瓶颈：**

*   寻找执行时间较长的系统（>5毫秒）
*   检查实体数量——实体越多，处理量越大
*   考虑[性能优化中的优化策略](PERFORMANCE_OPTIMIZATION-zh-CN-translation.md)

**示例：**

```
Name                    Time (ms)    Status
PhysicsSystem          8.234 ms     ACTIVE   ← Bottleneck!
RenderSystem           2.156 ms     ACTIVE
AISystem               0.892 ms     ACTIVE
```

### 切换系统开关

**在运行时禁用系统：**

1.  在系统面板中找到该系统
2.  点击**状态**列（显示"活跃"或"非活跃"）
3.  系统立即停止处理实体
4.  再次点击以重新启用

**用例：**

*   在不使用特定系统的情况下测试游戏行为
*   逐个禁用系统以隔离错误
*   在调试期间暂时禁用昂贵系统
*   验证系统依赖关系

> ⚠️ **重要** ：重启游戏时系统状态会重置。这是一个调试工具，不是存档/加载功能。

### 检查实体

**查看实体组件：**

1.  在实体面板中展开实体
2.  查看所有附加组件（例如，`C_Health`，`C_Transform`）
3.  展开组件以查看其属性
4.  值在游戏运行时实时更新

**示例实体结构：**

```
Entity #123 : /root/World/Player
├── C_Health
│   ├── current: 87.5
│   └── maximum: 100.0
├── C_Transform
│   └── position: (15.2, 0.0, 23.8)
└── C_Velocity
    └── velocity: (2.5, 0.0, 1.3)
```

### 查看关系

关系显示了实体之间是如何相互连接的。

**显示的关系类型：**

*   **实体 → 实体** : `Relationship: C_ChildOf -> Entity /root/World/Parent`
*   **实体 → 组件** : `Relationship: C_Damaged -> C_FireDamage`
*   **实体 → 原型** : `Relationship: C_Buff -> Archetype Player`
*   **实体 → 通配符** : `Relationship: C_Damage -> Wildcard`

**展开关系以查看：**

*   关系组件属性
*   目标组件属性（用于组件关系）
*   完整关系元数据

> 💡 **了解更多** ：有关创建和查询实体关系的详细信息，请参阅[关系](RELATIONSHIPS-zh-CN-translation.md)

### 使用搜索和筛选

**系统面板：**

*   在“筛选系统”框中输入名称以按名称查找系统
*   仅显示匹配的系统

**实体面板：**

*   在"过滤实体"框中输入以搜索
*   搜索实体名称、组件名称和属性名称
*   适用于在大世界中查找特定实体

### 多显示器设置

**弹出窗口：**

1.  点击调试查看器顶部的 **"弹出"** 按钮
2.  调试查看器移动到单独的窗口
3.  在第二个显示器上定位以实现永久可见性
4.  点击 **"Pop In"** 返回编辑器标签页

**优点：**

*   编辑场景时保持调试信息可见
*   游戏运行时监控性能
*   追踪实体变更而不切换面板

### 折叠/展开控件

**快速控件：**

*   **全部折叠** / **全部展开** \- 一键管理所有实体
*   **全部折叠系统** / **全部展开系统** \- 一键管理所有系统
*   点击可折叠/展开单个项目

## 🔧 常用工作流

### 性能优化工作流

1.  **按执行时间排序系统** （点击"时间 (ms)"标题）
2.  **识别最慢的系统** （排序列表顶部）
3.  **展开系统详情**以查看实体数量和原型数量
4.  **审查系统实现**以寻找优化机会
5.  **应用优化** 来自 [性能优化](PERFORMANCE_OPTIMIZATION-zh-CN-translation.md)
6.  **重新运行并比较** 执行时间

### 调试工作流

1.  **使用搜索/筛选识别问题实体**
2.  **展开实体**以查看所有组件
3.  **实时查看组件值**的更新
4.  **切换相关系统开/关**以隔离问题
5.  **检查关系**如果实体交互涉及
6.  **修复你的代码**中的问题

### 测试系统依赖

1.  **从编辑器中运行你的游戏**
2.  **使用状态列逐个禁用系统**
3.  **观察每个禁用系统的游戏行为**
4.  **记录你发现的依赖关系**
5.  **如有必要，设计更独立的系统**

## 📊 理解系统指标

当你在系统面板中展开一个系统时，你会看到详细的指标：

**执行时间（毫秒）：**

*   系统在 `process()` 函数中花费的时间
*   越低越好（大多数系统应争取低于1毫秒）
*   尖峰表示性能问题

**实体数量：**

*   与系统查询匹配的实体数量
*   高数量 + 高执行时间 = 需要优化
*   零实体可能表示查询问题

**原型数量：**

*   处理的唯一组件组合数量
*   较高的数量可能会影响性能
*   查看[性能优化](PERFORMANCE_OPTIMIZATION-zh-CN-translation.md#archetype-optimization)

**并行处理：**

*   `true` 如果系统使用并行迭代
*   `false` 用于顺序处理
*   并行系统可以更快地处理实体

**子系统信息：**

*   对于多子系统系统（高级功能）
*   显示每个子系统的实体数量

## ⚠️ 故障排除

### 调试查看器显示"调试模式已禁用"

**解决方案：**

1.  前往 `项目 > 项目设置`
2.  导航至 `GECS` 分类
3.  启用 "Debug Mode" 复选框
4.  重启你的游戏

> 💡 **性能提示** : 调试模式会增加额外开销。在生产版本中请禁用它。

### 没有实体/系统出现

**可能原因：**

1.  游戏未运行 - 按 F5 或 F6 从编辑器运行
2.  世界未创建 - 验证代码中是否存在 `ECS.world`
3.  实体/系统未添加到世界 - 检查 `world.add_child()` 调用

### 组件属性未更新

**解决方案：**

*   组件属性在变化时更新
*   没有 `@export` 的属性将不可见
*   确保您的系统正确修改组件属性

### 系统未切换

**可能原因：**

1.  系统设置了 `paused` 属性 - 检查系统代码
2.  调试器连接丢失 - 重新启动游戏
3.  系统处于关键状态 - 某些系统可能会忽略切换请求

## 🎯 最佳实践

### 开发期间

✅ **做：**

*   测试游戏时保持调试查看器打开
*   定期按时间排序系统以捕获性能退化
*   使用实体搜索来跟踪特定实体
*   禁用系统以测试游戏行为

❌ **不要：**

*   在生产构建中保持调试模式启用
*   依靠系统切换进行游戏逻辑（使用正确的激活模式）
*   期待完美的帧时间（调试模式会增加开销）

### 为了性能调优

1.  **首先建立基线** ：不使用调试查看器运行游戏，记录 FPS
2.  **启用调试查看器** : 识别高成本系统
3.  **聚焦前 3 名** : 首先优化最慢的系统
4.  **衡量影响** : 在修改后重新检查执行时间
5.  **禁用调试模式** : 总是在最终构建中分析而不带调试开销

## 🚀 高级技巧

### 自定义组件序列化

如果组件属性没有正确显示：

```gdscript
# Mark properties with @export for debug visibility
class_name C_CustomData
extends Component

@export var visible_property: int = 0  # ✅ Shows in debug viewer
var hidden_property: int = 0           # ❌ Won't appear
```

### 关系调试

使用调试查看器验证复杂关系查询：

1.  **创建带关系测试实体**
2.  **检查实体面板中的关系显示**
3.  **验证关系属性是否正确**
4.  **测试系统中的关系查询**

### 性能分析工作流

将调试查看器与 Godot 的分析器结合使用：

1.  **调试查看器** ：识别缓慢的 ECS 系统
2.  **Godot Profiler**: 深入分析特定功能
3.  **解决瓶颈** : 基于工具进行优化
4.  **验证改进** : 检查各项指标均得到提升

## 📚 相关文档

*   **[核心概念](CORE_CONCEPTS-zh-CN-translation.md)** \- 理解实体、组件和系统
*   **[性能优化](PERFORMANCE_OPTIMIZATION-zh-CN-translation.md)** \- 优化被识别为瓶颈的系统
*   **[关系](RELATIONSHIPS-zh-CN-translation.md)** \- 处理实体关系
*   **[故障排除](TROUBLESHOOTING-zh-CN-translation.md)** \- 常见问题和解决方案

## 💡 摘要

调试查看器是您查看 ECS 运行时的窗口。使用它来：

*   🔍 监控系统性能并识别瓶颈
*   🎮 实时检查实体和组件
*   🔗 可视化实体间的关系
*   ⚡ 用于调试时开启/关闭系统
*   📊 跟踪实体数量和原型分布

> **小技巧** ：将调试查看器弹出到第二个显示器，并在开发时保持可见。这样你能更快地发现性能问题和错误！

* * *

**下一步：**

*   学习[性能优化](PERFORMANCE_OPTIMIZATION-zh-CN-translation.md)以解决你发现的瓶颈
*   探索[关系](RELATIONSHIPS-zh-CN-translation.md)以更好地理解实体连接
*   如果你遇到问题，请检查[故障排除](TROUBLESHOOTING-zh-CN-translation.md)